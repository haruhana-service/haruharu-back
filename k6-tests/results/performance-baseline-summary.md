# 성능 테스트 베이스라인 (개선 전)

> 측정일: 2026-02-17 | 성능 최적화 전 기준점 측정 결과

## 테스트 환경

| 항목 | 값 |
|------|---|
| **서버** | EC2 t3.small (2 vCPU, 2GB RAM) |
| **JVM** | Heap 256~512MB, G1GC |
| **DB** | MySQL 8.0 (앱과 동일 EC2) |
| **HikariCP** | Pool Size 10 (기본값) |
| **Tomcat** | max-threads 200 (기본값) |
| **데이터** | Member 1만, DailyProblem 500만, Submission 350만 |
| **모니터링** | k6 + Prometheus + Grafana |
| **네트워크** | 로컬 MacBook → AWS 스테이징 |

---

## Load Test (정상 트래픽)

**조건**: 250 VU, 15분, think time 1~3초, 총 78,634건

| 지표 | 측정값 |
|------|--------|
| p95 응답 시간 | **27ms** |
| p99 응답 시간 | 69ms |
| 에러율 | **0.00%** |
| RPS | 87.1 req/s |

**API별 p95**: today 26ms, streaks 28ms, problem_detail 24ms, submissions 35ms, login 212ms

**VU별 변화**: 10→100→250 VU 전 구간 p95 변동 ±8% 이내 → **병목 없음**

**시스템 리소스**: CPU 25%, HikariCP Active 0.13, Pending 0 → 여유

---

## Stress Test (시스템 한계 탐색)

**조건**: 100→200→300→400→500 VU, 14분, 총 169,026건

| 지표 | 측정값 |
|------|--------|
| p95 응답 시간 | **1,040ms** |
| p99 응답 시간 | 1,751ms |
| 에러율 | **3.42%** (로그인 55.1%) |
| RPS | 194.4 req/s |
| 최대 응답 | 60,025ms (타임아웃) |

### VU별 병목 구간

| VU | p95 | 변화율 | 판정 |
|----|-----|--------|------|
| 100 | 867ms | 기준 | 정상 |
| 200 | 1,100ms | +27% | 정상 (선형) |
| **300** | **2,800ms** | **+145%** | **병목 시작** |
| 400 | 9,400ms | +236% | 심각 포화 |
| 500 | 9,400ms | +0% | 완전 포화 |

### 시스템 리소스 (Grafana)

| 리소스 | 평균 | 최대 | 상태 |
|--------|------|------|------|
| HikariCP Active | 3.14 | **10/10** | 풀 포화 |
| HikariCP Pending | 38.2 | **290** | 심각한 대기열 |
| System CPU | 37% | **99.9%** | 완전 포화 |
| Load Average | 11.2 | **127** | 극한 과부하 (코어 대비 63배) |
| JVM Threads | 175 | **424** | 스레드 풀 한계 |
| Heap | ~140MiB | ~310MiB/512MiB | 여유 |

### 병목 연쇄 반응

```
요청 폭증 → HikariCP 10개 풀 포화 → 290건 대기
→ 스레드 블로킹 → Load Average 127 폭등
→ CPU 컨텍스트 스위칭에 소모 → 99.9%
→ 응답 시간 9.4초 / 타임아웃 60초
```

---

## 식별된 병목 (우선순위)

| 순위 | 병목 | 근거 | 개선 방향 |
|------|------|------|-----------|
| 1 | **HikariCP 풀 부족** | Pool 10, Pending 290 | Pool 30으로 증가 |
| 2 | **DB 인덱스 부재** | daily_problem 500만 건 풀스캔 | member_id+assigned_at 복합 인덱스 |
| 3 | **Tomcat 스레드 부족** | 424개까지 증가 (기본 200 초과) | max-threads 300 |
| 4 | **CPU 리소스** | 2 vCPU 한계 | HikariCP 개선 후 재평가 |

---

## 핵심 요약

- **정상 트래픽(250 VU)**: p95 27ms, 에러 0% → 완벽 처리
- **한계점**: 300 VU에서 병목 시작 (p95 145% 급등)
- **근본 원인**: HikariCP 풀 10개 → 커넥션 대기 → CPU 포화 연쇄 반응
- **메모리/GC**: 병목 아님 (Heap 60%, Full GC 미발생)

---