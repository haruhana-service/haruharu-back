# ğŸ¯ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ & ê°œì„  ê°€ì´ë“œ

í•˜ë£¨í•˜ë‚˜(Haruhana) í”„ë¡œì íŠ¸ì˜ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë° ìµœì í™” ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

1. [í…ŒìŠ¤íŠ¸ ìˆœì„œ](#1-í…ŒìŠ¤íŠ¸-ìˆœì„œ)
2. [ë³‘ëª© ë¶„ì„ ë°©ë²•](#2-ë³‘ëª©-ë¶„ì„-ë°©ë²•)
3. [ì„±ëŠ¥ ê°œì„  ìš°ì„ ìˆœìœ„](#3-ì„±ëŠ¥-ê°œì„ -ìš°ì„ ìˆœìœ„)
4. [ê°œì„  ê²€ì¦ í”„ë¡œì„¸ìŠ¤](#4-ê°œì„ -ê²€ì¦-í”„ë¡œì„¸ìŠ¤)
5. [ì§€ì†ì  ëª¨ë‹ˆí„°ë§](#5-ì§€ì†ì -ëª¨ë‹ˆí„°ë§)

---

## 1. í…ŒìŠ¤íŠ¸ ìˆœì„œ

### ì „ì²´ í”Œë¡œìš°

```
1. Smoke Test (ê¸°ë³¸ ë™ì‘ í™•ì¸)
   â†“
2. Load Test (ì¼ë°˜ ë¶€í•˜)
   â†“
3. Stress Test (í•œê³„ì  íŒŒì•…)
   â†“
4. Spike Test (ê¸‰ì¦ ëŒ€ì‘)
```

---

### âœ… 1-1. Smoke Test (ê¸°ë³¸ ë™ì‘ í™•ì¸)

```bash
k6 run k6-tests/scripts/smoke-test.js
```

**ëª©ì **: ê¸°ë³¸ ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸

- **VU**: 1ëª…
- **Duration**: 1ë¶„
- **í†µê³¼ ì¡°ê±´**:
  - âœ… ëª¨ë“  APIê°€ 200 ì‘ë‹µ
  - âœ… p95 < 500ms
  - âœ… ì—ëŸ¬ìœ¨ < 1%

---

### âœ… 1-2. Load Test (ì¼ë°˜ ë¶€í•˜)

```bash
k6 run k6-tests/scripts/load-test.js
```

**ëª©ì **: ì‹¤ì œ ì‚¬ìš©ì í™˜ê²½ì—ì„œì˜ ì„±ëŠ¥ í™•ì¸

- **VU**: 10 â†’ 50 â†’ 100 (ì ì§„ì  ì¦ê°€)
- **Duration**: 15ë¶„
- **í†µê³¼ ì¡°ê±´**:
  - âœ… p95 < 500ms (ì‚¬ìš©ì ì²´ê° í’ˆì§ˆ)
  - âœ… p99 < 1000ms
  - âœ… ì—ëŸ¬ìœ¨ < 1%
  - âœ… RPS > 20 req/s

**í™•ì¸ ì‚¬í•­**:

```
ğŸ“Š Stageë³„ ì„±ëŠ¥ ë¶„ì„
   âœ… Stage 1 (10 VU):   í‰ê· : 100ms | p95: 200ms | p99: 350ms
   âœ… Stage 2 (50 VU):   í‰ê· : 175ms | p95: 350ms | p99: 600ms
   âš ï¸ Stage 3 (100 VU):  í‰ê· : 250ms | p95: 520ms | p99: 1100ms
```

**ë¶„ì„**:
- 10â†’50 VU: p95 75% ì¦ê°€ (ì •ìƒ)
- 50â†’100 VU: p95 48% ì¦ê°€ (ì •ìƒ)
- ì¦ê°€ìœ¨ì´ ì„ í˜•ì  â†’ âœ… ë³‘ëª© ì—†ìŒ

---

### âœ… 1-3. Stress Test (í•œê³„ì  íŒŒì•…)

```bash
k6 run k6-tests/scripts/stress-test.js
```

**ëª©ì **: ì‹œìŠ¤í…œì˜ í•œê³„ì™€ ë³‘ëª© ì§€ì  ë°œê²¬

- **VU**: 100 â†’ 200 â†’ 300 â†’ 400 (í•œê³„ê¹Œì§€)
- **Duration**: 12ë¶„
- **í†µê³¼ ì¡°ê±´**:
  - âœ… p95 < 1500ms
  - âœ… p99 < 2500ms
  - âœ… ì—ëŸ¬ìœ¨ < 5%

**í™•ì¸ ì‚¬í•­**:

```
ğŸ’¡ ë³‘ëª© ë¶„ì„:
   100â†’200 VU: p95 60% ì¦ê°€   (ì •ìƒ)
   200â†’300 VU: p95 135% ì¦ê°€  (âš ï¸ ë³‘ëª© ê°€ì†í™”!)
   300â†’400 VU: p95 200% ì¦ê°€  (ğŸš¨ ì‹¬ê°)

   âš ï¸ 200 VU ì´í›„ ì„±ëŠ¥ ì €í•˜ ê°€ì†í™”!
   ğŸ’¡ ì œì•ˆ: HikariCP pool size í™•ì¸, DB ì»¤ë„¥ì…˜ ë³‘ëª© ë¶„ì„
```

**ë³‘ëª© ë°œê²¬**: 200 VUë¶€í„° ê¸‰ê²©í•œ ì„±ëŠ¥ ì €í•˜

---

### âœ… 1-4. Spike Test (ê¸‰ì¦ ëŒ€ì‘)

```bash
k6 run k6-tests/scripts/spike-test.js
```

**ëª©ì **: ê°‘ì‘ìŠ¤ëŸ¬ìš´ íŠ¸ë˜í”½ ì¦ê°€ ì‹œ ëŒ€ì‘ë ¥ í™•ì¸

- **VU**: 10 â†’ 300 (30ì´ˆ ë§Œì— ê¸‰ì¦)
- **Duration**: 6ë¶„
- **í™•ì¸ ì‚¬í•­**:
  - âš¡ ê¸‰ì¦ ì‹œ ì—ëŸ¬ìœ¨ì€?
  - âš¡ ë³µêµ¬ ì‹œê°„ì€?
  - âš¡ ì„œë¹„ìŠ¤ ì•ˆì •ì„± ìœ ì§€?

---

## 2. ë³‘ëª© ë¶„ì„ ë°©ë²•

### 2-1. k6 í…ŒìŠ¤íŠ¸ ê²°ê³¼ì—ì„œ í™•ì¸

#### âœ… Stageë³„ ì„±ëŠ¥ ë¶„ì„

```
ğŸ¯ Stageë³„ ì„±ëŠ¥ ë¶„ì„
   Stage 1 (10 VU):  p95: 200ms
   Stage 2 (50 VU):  p95: 350ms  (+75%)
   Stage 3 (100 VU): p95: 500ms  (+43%)
```

**íŒë‹¨ ê¸°ì¤€**:
- ì¦ê°€ìœ¨ì´ **ì„ í˜•ì ** (50% ë‚´ì™¸) â†’ âœ… ì •ìƒ
- ì¦ê°€ìœ¨ì´ **ë¹„ì„ í˜•ì ** (100% ì´ìƒ) â†’ âš ï¸ ë³‘ëª©!

#### âœ… APIë³„ ì„±ëŠ¥ í…Œì´ë¸”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API                     â”‚  Count â”‚    Min â”‚    p50 â”‚    p95 â”‚    p99 â”‚    Max â”‚   Error â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… GET_today_problem    â”‚    450 â”‚     80 â”‚    200 â”‚    400 â”‚    600 â”‚    800 â”‚   0.5% â”‚
â”‚ âŒ POST_submission      â”‚     25 â”‚    200 â”‚    600 â”‚   1200 â”‚   1800 â”‚   3000 â”‚   1.2% â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë³‘ëª© API ë°œê²¬**: `POST_submission` - p95 1200ms (ëª©í‘œ: <500ms)

#### âœ… ì„±ëŠ¥ ê²½ê³ 

```
âš ï¸  ì„±ëŠ¥ ê²½ê³  ë° ê°œì„  ì œì•ˆ
   âš ï¸  POST_submission:
      - p95 1200ms (ëª©í‘œ: <500ms)
      - ìµœëŒ€ ì‘ë‹µì‹œê°„ 3000ms (ë§¤ìš° ëŠë¦¼!)
      ğŸ’¡ ì œì•ˆ: DB ì¿¼ë¦¬ ìµœì í™”, ì¸ë±ìŠ¤ ì¶”ê°€, ìºì‹± ê³ ë ¤
```

---

### 2-2. Grafanaì—ì„œ í™•ì¸

#### ğŸ”¥ í•µì‹¬ ì§€í‘œ (ìš°ì„ ìˆœìœ„ ìˆœ)

| ìˆœìœ„ | ì§€í‘œ | ì •ìƒ ë²”ìœ„ | ë³‘ëª© ì˜ì‹¬ |
|------|------|-----------|-----------|
| 1ï¸âƒ£ | **HikariCP Pending** | 0~5 | **>10** ğŸš¨ |
| 2ï¸âƒ£ | **CPU Usage** | <70% | **>85%** ğŸš¨ |
| 3ï¸âƒ£ | **DB Query Time** | p95 <100ms | **>200ms** ğŸš¨ |
| 4ï¸âƒ£ | **HTTP p95** | <500ms | **>1000ms** ğŸš¨ |
| 5ï¸âƒ£ | **GC STW** | <50ms | **>100ms** ğŸš¨ |
| 6ï¸âƒ£ | **Heap Usage** | <70% | **>80%** ğŸš¨ |

#### ğŸ“Š Grafana í™•ì¸ ë°©ë²•

```bash
# Stress Test ì‹¤í–‰í•˜ë©´ì„œ Grafana ëª¨ë‹ˆí„°ë§
k6 run k6-tests/scripts/stress-test.js

# ë™ì‹œì— Grafana í™•ì¸:
# - ë¡œì»¬: http://localhost:3000
# - Staging: http://<EC2-IP>:3000
```

**í™•ì¸ ìˆœì„œ**:

1. **HikariCP Pending** ê·¸ë˜í”„
   - Pendingì´ ê¸‰ì¦í•˜ëŠ” VU ìˆ˜ëŠ”? â†’ ë³‘ëª© ì‹œì‘ì !

2. **CPU Usage**
   - CPU 90% ì´ìƒ? â†’ CPU ë³‘ëª© or ë¹„íš¨ìœ¨ì  ì½”ë“œ

3. **DB Query Time**
   - ëŠë¦° ì¿¼ë¦¬ëŠ”? â†’ DB ì¸ë±ìŠ¤ í•„ìš”

---

## 3. ì„±ëŠ¥ ê°œì„  ìš°ì„ ìˆœìœ„

### ë°œê²¬ëœ ë³‘ëª©ë³„ ê°œì„  ë°©ë²•

#### ğŸ”¥ 1ìˆœìœ„: HikariCP Pending > 10 (ê°€ì¥ í”í•œ ë³‘ëª©)

**ì¦ìƒ**:
```
Grafana: HikariCP Pending 97
k6: p95 2000ms, ì—ëŸ¬ìœ¨ 5%
```

**ì›ì¸**: DB ì»¤ë„¥ì…˜ ë¶€ì¡±

**í•´ê²°**:
```yaml
# application-staging.yml
spring:
  datasource:
    hikari:
      maximum-pool-size: 20  # 10 â†’ 20ìœ¼ë¡œ ì¦ê°€
      minimum-idle: 10
```

**ê²€ì¦**:
```bash
k6 run k6-tests/scripts/load-test.js

# ê²°ê³¼ ë¹„êµ:
# [ê°œì„  ì „] p95: 1200ms, Pending: 97
# [ê°œì„  í›„] p95: 600ms, Pending: 5  âœ…
```

---

#### ğŸ”¥ 2ìˆœìœ„: DB ìŠ¬ë¡œìš° ì¿¼ë¦¬

**ì¦ìƒ**:
```
Grafana: daily_problem JOIN ì¿¼ë¦¬ 138ms
k6: GET_today_problem p95 > 600ms
```

**ì›ì¸**: ì¸ë±ìŠ¤ ë¶€ì¡±

**í•´ê²°**:
```sql
-- ë³µí•© ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX idx_daily_problem_date
ON daily_problem(problem_date, is_active);
```

**ê²€ì¦**:
```bash
k6 run k6-tests/scripts/load-test.js

# ê²°ê³¼:
# [ê°œì„  ì „] GET_today_problem p95: 600ms
# [ê°œì„  í›„] GET_today_problem p95: 250ms  âœ…
```

---

#### ğŸ”¥ 3ìˆœìœ„: CPU ë³‘ëª© (>90%)

**ì¦ìƒ**:
```
Grafana: CPU 91%, Load Avg 7.0 (2 vCPU)
k6: 200 VUë¶€í„° ì„±ëŠ¥ ê¸‰ê²©íˆ ì €í•˜
```

**ì›ì¸**: CPU ë¶€ì¡± or ë¹„íš¨ìœ¨ì  ì½”ë“œ

**í•´ê²° ì˜µì…˜**:
1. **ìˆ˜ì§ í™•ì¥**: 2 vCPU â†’ 4 vCPU
2. **ìˆ˜í‰ í™•ì¥**: ì¸ìŠ¤í„´ìŠ¤ 2ëŒ€ + ë¡œë“œë°¸ëŸ°ì„œ
3. **ì½”ë“œ ìµœì í™”**: ë¶ˆí•„ìš”í•œ ì—°ì‚° ì œê±°

**ê²€ì¦**:
```bash
k6 run k6-tests/scripts/stress-test.js

# ê²°ê³¼:
# [ê°œì„  ì „] 200 VU: CPU 91%
# [ê°œì„  í›„] 200 VU: CPU 65%  âœ…
```

---

## 4. ê°œì„  ê²€ì¦ í”„ë¡œì„¸ìŠ¤

### ê°œì„  ì‚¬ì´í´

```
1. Stress Testë¡œ ë³‘ëª© ë°œê²¬
   â†“
2. ê°œì„  ì ìš© (HikariCP, DB, CPU)
   â†“
3. Load Testë¡œ íš¨ê³¼ ê²€ì¦
   â†“
4. ëª©í‘œ ë‹¬ì„±?
   Yes â†’ Stress Testë¡œ ë‹¤ìŒ ë³‘ëª© ì°¾ê¸°
   No â†’ ë‹¤ë¥¸ ê°œì„  ì‹œë„
```

### âœ… ê°œì„  ì „í›„ ë¹„êµí‘œ ì˜ˆì‹œ

| í•­ëª© | ê°œì„  ì „ | ê°œì„  í›„ | ê°œì„ ìœ¨ |
|------|---------|---------|--------|
| **p95** | 1200ms | 600ms | **50% â†“** |
| **p99** | 2000ms | 1000ms | **50% â†“** |
| **ì—ëŸ¬ìœ¨** | 5% | 1% | **80% â†“** |
| **RPS** | 25 req/s | 45 req/s | **80% â†‘** |
| **HikariCP Pending** | 97 | 5 | **95% â†“** |

---

## 5. ì§€ì†ì  ëª¨ë‹ˆí„°ë§

### 5-1. CI/CDì— Load Test í†µí•©

```yaml
# .github/workflows/deploy-staging.yml
- name: Load Test (ì„±ëŠ¥ íšŒê·€ í™•ì¸)
  run: k6 run k6-tests/scripts/load-test.js

# Threshold ì‹¤íŒ¨ ì‹œ ë°°í¬ ì¤‘ë‹¨!
```

### 5-2. ì£¼ê¸°ì  í…ŒìŠ¤íŠ¸ ìŠ¤ì¼€ì¤„

| í…ŒìŠ¤íŠ¸ | ë¹ˆë„ | ëª©ì  |
|--------|------|------|
| **Smoke** | ë§¤ ë°°í¬ | ê¸°ë³¸ ë™ì‘ í™•ì¸ |
| **Load** | ì£¼ 1íšŒ | ì„±ëŠ¥ íšŒê·€ ë°©ì§€ |
| **Stress** | ì›” 1íšŒ | ë³‘ëª© ì¬ë°œê²¬ |
| **Spike** | ë¶„ê¸° 1íšŒ | ì´ë²¤íŠ¸ ëŒ€ë¹„ |

---

## ğŸ“– ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ

### Step 1: í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# 1. ê¸°ë³¸ ë™ì‘ í™•ì¸
k6 run k6-tests/scripts/smoke-test.js

# 2. ì¼ë°˜ ë¶€í•˜ í…ŒìŠ¤íŠ¸
k6 run k6-tests/scripts/load-test.js

# 3. í•œê³„ í…ŒìŠ¤íŠ¸
k6 run k6-tests/scripts/stress-test.js

# 4. ê¸‰ì¦ í…ŒìŠ¤íŠ¸
k6 run k6-tests/scripts/spike-test.js

# Staging í™˜ê²½ í…ŒìŠ¤íŠ¸
BASE_URL=https://staging.haruhana.com k6 run k6-tests/scripts/load-test.js
```

### Step 2: ë³‘ëª© ë¶„ì„

**k6 ê²°ê³¼ í™•ì¸**:
- âœ… Stageë³„ ì„±ëŠ¥ ë¶„ì„ â†’ ì–´ëŠ VUì—ì„œ ê¸‰ì¦?
- âœ… APIë³„ í…Œì´ë¸” â†’ ì–´ëŠ APIê°€ ëŠë¦¼?
- âœ… ì„±ëŠ¥ ê²½ê³  â†’ ê°œì„  ì œì•ˆ í™•ì¸

**Grafana í™•ì¸**:
- âœ… HikariCP Pending > 10?
- âœ… CPU > 85%?
- âœ… DB Query Time > 200ms?

### Step 3: ê°œì„  ì ìš©

**ìš°ì„ ìˆœìœ„**:
1. HikariCP pool size ì¦ê°€
2. DB ì¸ë±ìŠ¤ ì¶”ê°€
3. ìŠ¬ë¡œìš° ì¿¼ë¦¬ ìµœì í™”
4. CPU í™•ì¥ or ì½”ë“œ ìµœì í™”

### Step 4: ê²€ì¦

```bash
# Load Test ì¬ì‹¤í–‰ â†’ p95, ì—ëŸ¬ìœ¨ ê°œì„  í™•ì¸
k6 run k6-tests/scripts/load-test.js

# Stress Test ì¬ì‹¤í–‰ â†’ ë‹¤ìŒ ë³‘ëª© ì°¾ê¸°
k6 run k6-tests/scripts/stress-test.js

# ë°˜ë³µ!
```

---

## ğŸ“Š ì„±ëŠ¥ ëª©í‘œ (SLA)

### Load Test (100 VU)

| ì§€í‘œ | ëª©í‘œ | í˜„ì¬ |
|------|------|------|
| p95 | < 500ms | - |
| p99 | < 1000ms | - |
| ì—ëŸ¬ìœ¨ | < 1% | - |
| RPS | > 20 req/s | - |

### Stress Test (400 VU)

| ì§€í‘œ | ëª©í‘œ | í˜„ì¬ |
|------|------|------|
| p95 | < 1500ms | - |
| p99 | < 2500ms | - |
| ì—ëŸ¬ìœ¨ | < 5% | - |
| RPS | > 10 req/s | - |

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. âœ… Smoke Testë¡œ ê¸°ë³¸ ë™ì‘ í™•ì¸
2. âœ… Load Testë¡œ ì¼ë°˜ ì„±ëŠ¥ ì¸¡ì •
3. âœ… Stress Testë¡œ ë³‘ëª© ë°œê²¬
4. ğŸ”§ ë³‘ëª© ê°œì„  (HikariCP, DB, CPU)
5. âœ… Load Testë¡œ ê°œì„  íš¨ê³¼ ê²€ì¦
6. ğŸ” ë°˜ë³µ!

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [k6 Documentation](https://k6.io/docs/)
- [Grafana Dashboard](http://localhost:3000)
- [Prometheus Metrics](http://localhost:9090)
- [ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼](./results/)

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-02-09
**ì‘ì„±ì**: Claude Code + ê°œë°œíŒ€
